@model Megasoft2.ViewModel.PackLabelPrintViewModel


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    if (!Html.ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger fade in">
            @Html.ValidationSummary(true)
        </div>
    }
    <div id="errordiv">
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="col-xs-12">
                <div class="form-group">
                    <h4 class="text-center" style="font-weight:bold;">Pack Label Print</h4>
                </div>
                <hr />

                <div class="form-horizontal row spacer-sm">
                    <div class="form-group">
                        <div class="col-sm-6 ">
                            <div class="control-label col-sm-1" style="text-align:left;">
                                Job:
                            </div>
                            <div class="editor-field col-sm-4">
                                @Html.TextBoxFor(model => model.Job, new { @class = "form-control input-sm" })
                                @Html.ValidationMessageFor(model => model.Job)
                            </div>
                            <div class="col-sm-1 " style="text-align:left;">
                                <button type="submit" class="btn btn-success btn-sm" id="btnLoad" name="action:LoadBatchID">
                                    <i class="fa fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <div class="col-sm-6 ">
                            <div class="control-label col-sm-1" style="text-align:left;">
                                Printer
                            </div>
                            <div class="editor-field col-sm-4">
                                @Html.DropDownListFor(model => model.Printer, new SelectList(ViewBag.Printers, "Value", "Text"), new { @id = "ddlPrinter", @class = "form-control input-sm" })
                            </div>

                            <button type="button" id="btnPrintPackLabel" class="btn btn-default btn-sm " onclick="Print()"><i class="fa fa-print"></i></button>
                        </div>

                    </div>
                </div>                

                <div class="form-horizontal row">
                    <table class="table table-hover table-condensed table-responsive table-bordered table-striped text-nowrap" id="tblLabelInfo">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="SelectAll" /></th>
                                <th>Outer Label</th>
                                <th>Pack Size</th>
                                <th>No. of Labels</th>
                                <th>Extruder No.</th>
                                <th>Extruder Roll</th>
                                <th>Printer Roll No.</th>
                                <th>OP Code</th>
                                <th>Printer OP</th>
                            </tr>
                        </thead>

                        <tbody>

                            @if (Model != null)
                            {
                                if (Model.LabelDetails.Count() > 0)
                                {
                                    for (int i = 0; i < Model.LabelDetails.Count(); i++)
                                    {
                                        <tr>
                                            <td><input type="checkbox" id="Selected_@i" class="chkbLabelInfo" /></td>
                                            <td>@Model.LabelDetails[i].BatchId</td>
                                            <td>@Model.LabelDetails[i].PackSize</td>
                                            <td>@Model.LabelDetails[i].NoOfLabels</td>
                                            <td>
                                                @Html.TextBoxFor(model => model.LabelDetails[i].ExtruderNo, new { @class = "form-control input-sm" })
                                            </td>
                                            <td>
                                                @Html.TextBoxFor(model => model.LabelDetails[i].ExtruderRoll, new { @class = "form-control input-sm" })
                                            </td>
                                            <td>
                                                @Html.TextBoxFor(model => model.LabelDetails[i].PrintRoll, new { @class = "form-control input-sm" })
                                            </td>
                                            <td>
                                                @Html.TextBoxFor(model => model.LabelDetails[i].OpCode, new { @class = "form-control input-sm" })
                                            </td>
                                            <td>
                                                @Html.TextBoxFor(model => model.LabelDetails[i].PrinterOp, new { @class = "form-control input-sm" })
                                            </td>


                                        </tr>
                                    }
                                }
                            }
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
}

@*<style>
    .odd{
        text-align: center;
    }
</style>*@
@Scripts.Render("~/Scripts/jquery-1.8.2.min.js")
@Scripts.Render("~/Scripts/jquery.validate.min.js")
@Scripts.Render("~/Scripts/jquery.validate.unobtrusive.min.js")
@*@Scripts.Render("~/Content/DataTables/datatables.min.js")*@
@*@Scripts.Render("~/Content/DataTables/jszip.min.js")*@

<script type="text/javascript">
    //var table = $('#tblLabelInfo').DataTable({
    //    dom: 'Bfrtip',
    //    paging: false,
    //    "rowReorder": false,
    //    "ordering": false,
    //    //"scrollY": 400,
    //    //"scrollX": true,
    //    //order: [[1, 'asc']],
    //    buttons: [],
    //    "orderClasses": false,
    //    "searching":false
    //});

    $(document).ready(function () {
        //change page title text
        $('#megasoftTitle').text(' Megasoft - Pack Label Print');
        var span = document.getElementById("megasoftTitle");
        span.style.fontSize = "x-small";



    });

    $('#SelectAll').change(function () {
        if ($('#SelectAll').is(":checked")) {
            $(".chkbLabelInfo").prop('checked', true);
        }
        else {
            $(".chkbLabelInfo").prop('checked', false);
        }
    })

    function Print() {
        let outer = $('#tblLabelInfo > tbody').find('tr').eq(0).find('td:eq(1)').text();
        var selectedList = [];
        let rowCount = $('#tblLabelInfo > tbody > tr').length;
        for (var i = 0; i < rowCount; i++) {
            var checkbox = $('#Selected_' + i).is(':checked');
            if (checkbox == true) {
                var myObject = new Object();
                myObject.Job = $('#Job').val();
                myObject.BatchId = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(1)').text();
                myObject.PackSize = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(2)').text();
                myObject.NoOfLabels = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(3)').text();
                myObject.ExtruderNo = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(4)').find('input[type=text]').val();
                myObject.ExtruderRoll = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(5)').find('input[type=text]').val();
                myObject.PrintRoll = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(6)').find('input[type=text]').val();
                myObject.OpCode = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(7)').find('input[type=text]').val();
                /*myObject.Packer = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(8)').find('input[type=text]').val();*/
                myObject.PrinterOp = $('#tblLabelInfo > tbody').find('tr').eq(i).find('td:eq(8)').find('input[type=text]').val();
                myObject.Printer = $('#ddlPrinter').val();
                selectedList.push(myObject);
            }
        }
        var exportdata = JSON.stringify({ details: JSON.stringify(selectedList) });

        $.ajax({
            type: "POST",
            url: "@Url.Action("Print","PackLabelPrint")",
            data: exportdata,
            contentType: "application/json; chaarset=utf-8",
            dataType: "json",
            success: OnSuccess,//need to code
            failure: OnErrorCall//need to code
        });

        function OnSuccess(response) {
            alert("Printed");
        }

        function OnErrorCall(response) {
            alert("Not Printed lol");
        }
    }

</script>